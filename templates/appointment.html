{% extends 'base.html' %}

{% block title %}{{ _('book_appointment') }} - Shweta Medical Mart{% endblock %}

{% block content %}
<style>
    .bg-gradient-success {
        background: linear-gradient(135deg, #15803d 0%, #166534 100%);
    }

    .appointment-card {
        border-radius: 20px;
        overflow: hidden;
    }

    .info-icon-box {
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        background-color: #f0fdf4;
        color: #15803d;
        font-size: 1.4rem;
        flex-shrink: 0;
    }

    .form-control:focus {
        border-color: #15803d !important;
        box-shadow: 0 0 0 0.25rem rgba(21, 128, 61, 0.1) !important;
    }
</style>

<div class="container py-5 mt-4">
    <div class="row g-4 g-lg-5 align-items-stretch">
        <!-- Left: Doctor Info Card -->
        <div class="col-lg-5">
            <div class="card appointment-card border-0 shadow-lg h-100">
                <div class="bg-gradient-success p-5 text-white position-relative overflow-hidden">
                    <!-- Subtle background decoration -->
                    <i class="fas fa-stethoscope position-absolute end-0 bottom-0 opacity-10 fa-8x mb-n4 me-n4"></i>

                    <h2 class="fw-bold mb-4">{{ _('doctor_info') }}</h2>
                    <div class="d-flex align-items-center">
                        <div class="bg-white rounded-circle p-1 me-3 shadow-sm">
                            <div class="bg-light rounded-circle p-3 text-success">
                                <i class="fas fa-user-md fa-2x"></i>
                            </div>
                        </div>
                        <div>
                            <h4 class="fw-bold mb-0">{{ _('dr_name') }}</h4>
                            <p class="mb-0 opacity-75 small">{{ _('dr_specialty') }}</p>
                        </div>
                    </div>
                </div>

                <div class="card-body p-4 p-md-5 bg-white">
                    <div class="d-flex mb-4">
                        <div class="info-icon-box me-3">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div>
                            <h6 class="fw-bold mb-1 text-dark">{{ _('clinic_timing') }}</h6>
                            <p class="text-muted mb-0">{{ _('timing_desc') }}</p>
                            <p class="text-danger small mt-1 fw-medium mb-0"><i class="fas fa-info-circle me-1"></i> {{
                                _('sunday_closed') }}</p>
                        </div>
                    </div>

                    <div class="d-flex mb-4">
                        <div class="info-icon-box me-3">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div>
                            <h6 class="fw-bold mb-1 text-dark">{{ _('location_title') }}</h6>
                            <p class="text-muted mb-0 small">{{ _('address_short') }}</p>
                            <a href="https://www.google.com/maps/dir/?api=1&destination=16.831182,74.643547"
                                target="_blank"
                                class="text-success small fw-bold text-decoration-none d-block mt-2 mb-3">
                                <i class="fas fa-directions me-1"></i> Get Directions
                            </a>
                            <div class="ratio ratio-16x9 rounded-3 overflow-hidden shadow-sm border border-light">
                                <iframe
                                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3818.6653205763914!2d74.643547!3d16.831182!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3bc123000dfb39e5%3A0xc47e870500e28f32!2sShweta%20Medical%20and%20Generic%20Stores!5e0!3m2!1sen!2sin!4v1706435470000!5m2!1sen!2sin"
                                    style="border:0;" allowfullscreen="" loading="lazy"
                                    referrerpolicy="no-referrer-when-downgrade">
                                </iframe>
                            </div>
                        </div>
                    </div>

                    <div class="mt-auto pt-4 border-top">
                        <div class="alert alert-success border-0 rounded-4 bg-light bg-opacity-50 small mb-0">
                            <i class="fas fa-shield-alt text-success me-2"></i> {{ _('contact_promise') }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right: Modern Appointment Form -->
        <div class="col-lg-7">
            <div class="card appointment-card border-0 shadow-lg p-3 p-md-4 bg-white">
                <div class="card-body">
                    <div class="mb-4">
                        <span
                            class="badge bg-success bg-opacity-10 text-success rounded-pill px-3 py-2 mb-3 fw-bold">Online
                            Booking</span>
                        <h2 class="fw-bold text-dark">{{ _('appointment_title') }}</h2>
                        <p class="text-muted small">Professional healthcare advice tailored for you.</p>
                    </div>

                    <form id="appointmentFormPage">
                        <div class="row g-4">
                            <!-- Name -->
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" id="apt_name" class="form-control border-light-subtle rounded-3"
                                        placeholder="{{ _('name_placeholder') }}" required>
                                    <label class="text-muted"><i class="fas fa-user me-2 text-success opacity-50"></i>{{
                                        _('full_name') }}</label>
                                </div>
                            </div>
                            <!-- Phone -->
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="tel" id="apt_phone" class="form-control border-light-subtle rounded-3"
                                        placeholder="{{ _('phone_placeholder') }}" required>
                                    <label class="text-muted"><i
                                            class="fas fa-phone me-2 text-success opacity-50"></i>{{ _('phone_label')
                                        }}</label>
                                </div>
                            </div>
                            <!-- Date -->
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="date" id="apt_date" class="form-control border-light-subtle rounded-3"
                                        required>
                                    <label class="text-muted"><i
                                            class="fas fa-calendar-alt me-2 text-success opacity-50"></i>{{
                                        _('date_label') }}</label>
                                </div>
                            </div>
                            <!-- Time -->
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="time" id="apt_time" class="form-control border-light-subtle rounded-3"
                                        required>
                                    <label class="text-muted"><i
                                            class="fas fa-clock me-2 text-success opacity-50"></i>{{ _('time_label')
                                        }}</label>
                                </div>
                            </div>
                            <!-- Message -->
                            <div class="col-12">
                                <div class="form-floating">
                                    <textarea id="apt_message" class="form-control border-light-subtle rounded-3"
                                        style="height: 120px" placeholder="{{ _('message_placeholder') }}"
                                        required></textarea>
                                    <label class="text-muted"><i
                                            class="fas fa-comment-medical me-2 text-success opacity-50"></i>{{
                                        _('message_label') }}</label>
                                </div>
                            </div>
                            <!-- Submit Button -->
                            <div class="col-12 mt-4">
                                <button type="submit"
                                    class="btn btn-success btn-lg w-100 py-3 fw-bold rounded-3 shadow-sm border-0 transition-all hover-lift">
                                    <i class="fab fa-whatsapp me-2"></i> {{ _('book_appointment') }}
                                </button>
                                <p class="text-center text-muted small mt-3 mb-0">
                                    <i class="fas fa-info-circle me-1"></i> Will be sent via WhatsApp
                                </p>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('appointmentFormPage').addEventListener('submit', function (e) {
        e.preventDefault();

        // Loading state (optional UI feedback)
        const btn = this.querySelector('button[type="submit"]');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Processing...';
        btn.disabled = true;

        // Get form values
        const name = document.getElementById('apt_name').value;
        const phone = document.getElementById('apt_phone').value;
        const date = document.getElementById('apt_date').value;
        const time = document.getElementById('apt_time').value;
        const message = document.getElementById('apt_message').value;

        // Construct WhatsApp message
        const waText = `*New Appointment Request*%0A%0A*Name:* ${name}%0A*Phone:* ${phone}%0A*Date:* ${date}%0A*Time:* ${time}%0A*Message:* ${message}`;
        const waUrl = `https://wa.me/919923346656?text=${waText}`;

        // Small delay to show feedback
        setTimeout(() => {
            window.open(waUrl, '_blank');
            alert("{{ _('apt_success_msg') }}");
            this.reset();
            btn.innerHTML = originalText;
            btn.disabled = false;
        }, 800);
    });
</script>
{% endblock %}